<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">    
<mapper namespace="com.goodee.everydoctor.pet.diagnosis.PetDiagnosisMapper">

	<select id="findReservatedDetail" parameterType="PetDiagnosisVO" resultMap="findReservatedDetailResult">
		SELECT *
		FROM PETDIAGNOSIS PD
		LEFT JOIN PETDANSFILE PF 
		ON(PD.PDANSNUM = PF.PETDANSNUM)
		WHERE PD.PDANSNUM = #{pDansNum}
	</select>
	
	<resultMap type="PetDiagnosisVO" id="findReservatedDetailResult">
		<id column="PDANSNUM" property="pDansNum"/>
		<result column="PUSERNAME" property="pUsername"/>
		<result column="PETNUM" property="petNum"/>
		<result column="PDOCTORNAME" property="pDoctorname"/>
		<result column="PDANSCATEGORY" property="pDansCategory"/>
		<result column="PDANSCONTENT" property="pDansContent"/>
		<result column="PDANSREQTIME" property="pDansReqTime"/>
		<result column="PDANSSTATUS" property="pDansStatus"/>
		<collection property="pDansFiles" javaType="List" ofType="FileVO">
			<id column="PETDANSFILENUM" property="fileNum"/>
			<result column="PETDANSFILENAME" property="fileName"/>
			<result column="PETDANSFILEORINAME" property="fileOriName"/>
		</collection>
	</resultMap>

	<select id="findReservatedListCount" parameterType="PetDiagnosisPager" resultType="Long">
		SELECT COUNT(PDANSNUM) FROM PETDIAGNOSIS WHERE PDOCTORNAME = #{username}
	</select>

	<select id="findReservatedList" parameterType="PetDiagnosisPager" resultMap="findReservatedListResult">
		SELECT *
		FROM PETDIAGNOSIS PD
		LEFT JOIN PETDANSFILE PF 
		ON(PD.PDANSNUM = PF.PETDANSNUM)
		WHERE (PD.PDOCTORNAME = #{username}) AND PD.PDANSSTATUS = 0
		ORDER BY PD.PDANSREQTIME ASC
	</select>
	
	<resultMap type="PetDiagnosisVO" id="findReservatedListResult">
		<id column="PDANSNUM" property="pDansNum"/>
		<result column="PUSERNAME" property="pUsername"/>
		<result column="PETNUM" property="petNum"/>
		<result column="PDOCTORNAME" property="pDoctorname"/>
		<result column="PDANSCATEGORY" property="pDansCategory"/>
		<result column="PDANSCONTENT" property="pDansContent"/>
		<result column="PDANSREQTIME" property="pDansReqTime"/>
		<result column="PDANSSTATUS" property="pDansStatus"/>
		<collection property="pDansFiles" javaType="List" ofType="FileVO">
			<id column="PETDANSFILENUM" property="fileNum"/>
			<result column="PETDANSFILENAME" property="fileName"/>
			<result column="PETDANSFILEORINAME" property="fileOriName"/>
		</collection>
	</resultMap>

	<insert id="inputPetDiagnosis" parameterType="PetDiagnosisVO" useGeneratedKeys="true" keyProperty="pDansNum">
		INSERT INTO PETDIAGNOSIS(PDANSNUM, PUSERNAME, PETNUM, PDOCTORNAME, PDANSCATEGORY, PDANSCONTENT, PDANSREQTIME, PDANSSTATUS)
			VALUES (NULL, #{pUsername}, #{petNum}, #{pDoctorname}, #{pDansCategory}, #{pDansContent}, NOW(), 0)
	</insert>

	<select id="findPetCategories" resultType="HospitalCategoryVO">
		SELECT * FROM CATEGORY WHERE CATEGORYKIND = 1
	</select>

	<select id="findOwnPetList" parameterType="UserVO" resultType="PetVO">
		SELECT * FROM PET WHERE USERNAME = #{username}
	</select>

	<select id="findOwnPetCount" parameterType="UserVO" resultType="Integer">
		SELECT COUNT(PETNUM) FROM PET WHERE USERNAME = #{username}
	</select>
	
</mapper>